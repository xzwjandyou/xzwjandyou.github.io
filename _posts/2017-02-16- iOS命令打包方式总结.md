---
layout: post
title: 'iOS命令打包方式总结'
tags: [language]
---

---

自动化打包的工具网上有很多，例如shenzhen，fastlane，可以直接打包然后上传到服务器，很成熟了，他们的使用这里就不重点说了。

这里只介绍一下基本的命令使用，所有的自动化脚本都是基于命令打包的。

## 第一步：关于打包方式：

DESCRIPTION

xcodebuild builds one or more targets contained in an Xcode project, or builds a scheme contained in an    Xcode workspace or Xcode project.

两种方式1.一种是project，另一种是包含多个project（例如用到了pods的工程）。

1.project方式：

xcodebuild -project name.xcodeproj -target targetname -configuration Release -sdk iphoneos build CODE_SIGN_IDENTITY="$(CODE_SIGN_IDENTITY)" PROVISIONING_PROFILE="$(PROVISIONING_PROFILE)"

eg：

CODE_SIGN_IDENTITY   :  iPhone Developer: XXX XXX (C2XXXXXS8)

PROVISIONING_PROFILE : XXXXXX-XX-XX-XXXX-XXXX

这里的两个可以通过keychain－证书－显示简介－常用名称 和本地的~/Library/MobileDevice/Provisioning\ Profiles找到，例如：85477e68-979f-4444-8f5d-XXXXX.mobileprovision，后面的.mobileprovision去掉。

2.workspace方式：

xcodebuild -workspace name.xcworkspace -scheme schemename -configuration Release -sdk iphoneos build CODE_SIGN_IDENTITY="$(CODE_SIGN_IDENTITY)" PROVISIONING_PROFILE="$(PROVISIONING_PROFILE)"

eg：xcodebuild -workspace XXX.xcworkspace -scheme schemename -configuration Release -sdk iphoneos build CODE_SIGN_IDENTITY="iPhone Developer: XXX XXX (C2XXXXXS8)" PROVISIONING_PROFILE="XXXXXX-XX-XX-XXXX-XXXX" CONFIGURATION_BUILD_DIR='工程绝对路径/build/Release-iphoneos' ONLY_ACTIVE_ARCH=NO
这里注意要加上：CONFIGURATION_BUILD_DIR='工程绝对路径/build/Release-iphoneos' ONLY_ACTIVE_ARCH=NO。使用CONFIGURATION_BUILD_DIR来显式指定输出编译后的文件路径。因为workspace默认不会自动创建build路径。

成功后会出现：** BUILD SUCCEEDED **，到此build成功。

## 第二步：生成ipa包

xcrun -sdk iphoneos -v PackageApplication ./build/Release-iphoneos/XXX.app -o ~/Desktop/XXX.ipa
在打包过程中发现了一点问题，有时候会有如下错误：

ld normal armv7 failed

Ld normal arm64

library not found

可以从几个方面检查，1.出现XXXnot found的时候，这个文件如果不存在不需要，打开XXX.xcodeproj查找这个文件是不是在里面出现了，出现了就清理掉。2.library not found，看下是什么库导致的，在link binary with libraries 中删除重新添加。


